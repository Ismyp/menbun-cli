{%- comment -%}
Custom Shop Section - Personalisierbare Produkte
{%- endcomment -%}

<style>
.custom-shop {
  padding: 50px 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.shop-header {
  text-align: center;
  margin-bottom: 40px;
}

.shop-title {
  font-size: 2.5rem;
  font-weight: bold;
  margin-bottom: 10px;
}

.shop-subtitle {
  font-size: 1.2rem;
  color: #666;
}

.products-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 30px;
}

.product-box {
  background: white;
  border: 1px solid #ddd;
  border-radius: 10px;
  overflow: hidden;
  transition: transform 0.3s ease;
}

.product-box:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.product-image-area {
  height: 200px;
  background: #f5f5f5;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.product-image-area img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.product-info {
  padding: 20px;
}

.product-name {
  font-size: 1.3rem;
  font-weight: bold;
  margin-bottom: 10px;
}

.product-price {
  font-size: 1.2rem;
  color: #e74c3c;
  font-weight: bold;
  margin-bottom: 15px;
}

.product-options {
  margin-bottom: 15px;
}

.option-row {
  margin-bottom: 10px;
}

.option-label {
  display: block;
  font-weight: 600;
  margin-bottom: 5px;
}

.option-select {
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 5px;
}

.personalization-area {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 15px;
}

.personalization-title {
  font-weight: bold;
  margin-bottom: 10px;
}

.checkbox-container {
  display: flex;
  gap: 15px;
  margin-bottom: 10px;
}

.checkbox-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.text-input {
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
  margin-top: 5px;
  display: none;
}

.cart-button {
  width: 100%;
  background: #28a745;
  color: white;
  border: none;
  padding: 12px;
  border-radius: 6px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
}

.cart-button:hover {
  background: #218838;
}

.cart-button:disabled {
  background: #6c757d;
}
</style>

<div class="custom-shop">
  <div class="shop-header">
    <h2 class="shop-title">{{ section.settings.main_title }}</h2>
    <p class="shop-subtitle">{{ section.settings.main_subtitle }}</p>
  </div>

  <div class="products-container">
    {%- if section.settings.product_collection != blank -%}
      {%- for product in section.settings.product_collection.products -%}
        {%- if forloop.index <= section.settings.max_products -%}
        <div class="product-box" data-product-id="{{ product.selected_or_first_available_variant.id }}">
          <div class="product-image-area">
            {%- if product.featured_image -%}
              {{ product.featured_image | image_url: width: 400 | image_tag: alt: product.title }}
            {%- else -%}
              <div style="font-size: 3rem; color: #ccc;">üì¶</div>
            {%- endif -%}
          </div>
          
          <div class="product-info">
            <h3 class="product-name">{{ product.title }}</h3>
            <div class="product-price">{{ product.selected_or_first_available_variant.price | money }}</div>
            
            <div class="product-options">
              {%- for option in product.options_with_values -%}
                <div class="option-row">
                  <label class="option-label">{{ option.name }}</label>
                  <select class="option-select">
                    {%- for value in option.values -%}
                      <option value="{{ value }}">{{ value }}</option>
                    {%- endfor -%}
                  </select>
                </div>
              {%- endfor -%}
            </div>

            <div class="personalization-area">
              <div class="personalization-title">Personalisierung</div>
              <div class="checkbox-container">
                <label class="checkbox-item">
                  <input type="checkbox" class="name-checkbox">
                  Name hinzuf√ºgen
                </label>
                <label class="checkbox-item">
                  <input type="checkbox" class="number-checkbox">
                  Nummer hinzuf√ºgen
                </label>
              </div>
              <input type="text" class="text-input name-input" placeholder="Name eingeben">
              <input type="text" class="text-input number-input" placeholder="Nummer eingeben">
            </div>

            <button type="button" class="cart-button">
              In den Warenkorb
            </button>
          </div>
        </div>
        {%- endif -%}
      {%- endfor -%}
    {%- else -%}
      <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px;">
        <h3>Keine Produkte</h3>
        <p>Bitte Produktkollektion in den Einstellungen ausw√§hlen.</p>
      </div>
    {%- endif -%}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Personalisierung Toggle
  document.querySelectorAll('.name-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const nameInput = this.closest('.product-box').querySelector('.name-input');
      nameInput.style.display = this.checked ? 'block' : 'none';
      if (!this.checked) nameInput.value = '';
    });
  });

  document.querySelectorAll('.number-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const numberInput = this.closest('.product-box').querySelector('.number-input');
      numberInput.style.display = this.checked ? 'block' : 'none';
      if (!this.checked) numberInput.value = '';
    });
  });

  // Add to Cart
  document.querySelectorAll('.cart-button').forEach(button => {
    button.addEventListener('click', async function() {
      const productBox = this.closest('.product-box');
      const productId = productBox.getAttribute('data-product-id');
      
      if (!productId) return;
      
      const properties = {};
      
      // Name
      const nameCheckbox = productBox.querySelector('.name-checkbox');
      const nameInput = productBox.querySelector('.name-input');
      if (nameCheckbox.checked && nameInput.value.trim()) {
        properties['Name'] = nameInput.value.trim();
      }
      
      // Nummer
      const numberCheckbox = productBox.querySelector('.number-checkbox');
      const numberInput = productBox.querySelector('.number-input');
      if (numberCheckbox.checked && numberInput.value.trim()) {
        properties['Nummer'] = numberInput.value.trim();
      }
      
      try {
        this.disabled = true;
        this.textContent = 'Wird hinzugef√ºgt...';
        
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            id: parseInt(productId),
            quantity: 1,
            properties: properties
          })
        });
        
        if (response.ok) {
          this.textContent = '‚úì Hinzugef√ºgt!';
          this.style.background = '#28a745';
          setTimeout(() => {
            this.textContent = 'In den Warenkorb';
            this.disabled = false;
          }, 2000);
        } else {
          throw new Error('Fehler');
        }
      } catch (error) {
        this.textContent = 'Fehler';
        this.style.background = '#dc3545';
        setTimeout(() => {
          this.textContent = 'In den Warenkorb';
          this.style.background = '#28a745';
          this.disabled = false;
        }, 2000);
      }
    });
  });
});
</script>

{% schema %}
{
  "name": "Custom Shop",
  "tag": "section",
  "class": "section-custom-shop",
  "settings": [
    {
      "type": "text",
      "id": "main_title",
      "label": "Titel",
      "default": "Shop"
    },
    {
      "type": "text",
      "id": "main_subtitle",
      "label": "Untertitel",
      "default": "Personalisierbare Produkte"
    },
    {
      "type": "collection",
      "id": "product_collection",
      "label": "Produktkollektion"
    },
    {
      "type": "range",
      "id": "max_products",
      "label": "Max. Produkte",
      "min": 1,
      "max": 20,
      "default": 8
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Custom Shop"
    }
  ]
}
{% endschema %}
